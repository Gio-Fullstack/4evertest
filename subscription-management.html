<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription Management - 4Ever</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles/profile.css">
    <link rel="stylesheet" href="styles/navigation.css">
    
    <style>
        .subscription-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-family: var(--font-display);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .page-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 1.5rem;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: var(--primary-color);
        }

        .subscription-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .section-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 2rem;
        }

        .section-card h2 {
            font-family: var(--font-display);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-card h2 i {
            color: var(--primary-color);
        }

        .current-plan {
            background: linear-gradient(135deg, var(--primary-color) 0%, #704214 100%);
            color: white;
            padding: 1.5rem;
            border-radius: var(--radius-md);
            margin-bottom: 1.5rem;
        }

        .current-plan h3 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .current-plan .price {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .current-plan .price span {
            font-size: 1.2rem;
            font-weight: 400;
            opacity: 0.9;
        }

        .current-plan p {
            opacity: 0.95;
            margin-bottom: 1rem;
        }

        .plan-features {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
        }

        .plan-features li {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            color: rgba(255, 255, 255, 0.95);
        }

        .plan-features i {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }

        .renewal-info {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: var(--radius-sm);
            margin-top: 1rem;
        }

        .renewal-info strong {
            display: block;
            margin-bottom: 0.25rem;
        }

        .plan-options {
            display: grid;
            gap: 1rem;
        }

        .plan-option {
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .plan-option:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.1);
        }

        .plan-option.current {
            border-color: var(--primary-color);
            background: rgba(139, 69, 19, 0.05);
        }

        .plan-option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .plan-option h4 {
            font-size: 1.25rem;
            color: var(--text-primary);
        }

        .plan-option .price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .plan-option p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .plan-option .badge {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .payment-method {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
        }

        .payment-method-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .payment-icon {
            width: 50px;
            height: 35px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .payment-details h4 {
            font-size: 1rem;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .payment-details p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .billing-table {
            width: 100%;
            border-collapse: collapse;
        }

        .billing-table th {
            text-align: left;
            padding: 1rem;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 1px solid var(--border-color);
        }

        .billing-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .billing-table tr:hover {
            background: var(--bg-secondary);
        }

        .status-badge {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-badge.paid {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .status-badge.pending {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #704214;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.2);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-primary);
            border-color: var(--primary-color);
        }

        .btn-danger {
            background: transparent;
            color: #dc2626;
            border: 1px solid #dc2626;
        }

        .btn-danger:hover {
            background: #dc2626;
            color: white;
        }

        .cancel-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(220, 38, 38, 0.05);
            border: 1px solid rgba(220, 38, 38, 0.2);
            border-radius: var(--radius-md);
        }

        .cancel-section h3 {
            color: #dc2626;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cancel-section p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .card-logos {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .card-logos i {
            font-size: 2rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .subscription-grid {
                grid-template-columns: 1fr;
            }

            .billing-table {
                font-size: 0.9rem;
            }

            .billing-table th,
            .billing-table td {
                padding: 0.75rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar"></nav>

    <div class="subscription-container">
        <a href="admin-dashboard.html" class="back-link">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
        </a>

        <div class="page-header">
            <h1>Subscription Management</h1>
            <p>Manage your subscription, payment method, and billing</p>
        </div>

        <div class="subscription-grid">
            <!-- Current Plan Section -->
            <div class="section-card">
                <h2><i class="fas fa-crown"></i> Current Plan</h2>
                
                <div class="current-plan">
                    <h3>Premium Plan</h3>
                    <div class="price">$18<span>/month</span></div>
                    <p>Full access for one profile</p>
                    
                    <ul class="plan-features">
                        <li><i class="fas fa-check-circle"></i> Unlimited stories</li>
                        <li><i class="fas fa-check-circle"></i> Unlimited connections</li>
                        <li><i class="fas fa-check-circle"></i> Unlimited AI recordings</li>
                        <li><i class="fas fa-check-circle"></i> Unlimited storage</li>
                        <li><i class="fas fa-check-circle"></i> Manage family payment methods</li>
                    </ul>

                    <div class="renewal-info">
                        <strong>Next billing date:</strong>
                        December 15, 2024
                    </div>
                </div>

                <button class="btn btn-secondary" style="width: 100%;" onclick="showUpgradeModal()">
                    <i class="fas fa-arrow-up"></i> Change Plan
                </button>
            </div>

            <!-- Payment Method Section -->
            <div class="section-card">
                <h2><i class="fas fa-credit-card"></i> Payment Method</h2>
                
                <div class="payment-method">
                    <div class="payment-method-info">
                        <div class="payment-icon">
                            <i class="fab fa-cc-visa" style="color: #1434CB;"></i>
                        </div>
                        <div class="payment-details">
                            <h4>Visa ending in 4242</h4>
                            <p>Expires 12/2026</p>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="showPaymentModal()">
                        <i class="fas fa-edit"></i> Update
                    </button>
                </div>

                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
                    <i class="fas fa-lock"></i> Your payment information is encrypted and secure
                </p>
            </div>

            <!-- Billing History Section -->
            <div class="section-card full-width">
                <h2><i class="fas fa-file-invoice-dollar"></i> Billing History</h2>
                
                <table class="billing-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Invoice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Nov 15, 2024</td>
                            <td>Premium Plan - Monthly</td>
                            <td>$18.00</td>
                            <td><span class="status-badge paid">Paid</span></td>
                            <td><a href="#" style="color: var(--primary-color);"><i class="fas fa-download"></i> Download</a></td>
                        </tr>
                        <tr>
                            <td>Oct 15, 2024</td>
                            <td>Premium Plan - Monthly</td>
                            <td>$18.00</td>
                            <td><span class="status-badge paid">Paid</span></td>
                            <td><a href="#" style="color: var(--primary-color);"><i class="fas fa-download"></i> Download</a></td>
                        </tr>
                        <tr>
                            <td>Sep 15, 2024</td>
                            <td>Premium Plan - Monthly</td>
                            <td>$18.00</td>
                            <td><span class="status-badge paid">Paid</span></td>
                            <td><a href="#" style="color: var(--primary-color);"><i class="fas fa-download"></i> Download</a></td>
                        </tr>
                        <tr>
                            <td>Aug 15, 2024</td>
                            <td>Premium Plan - Monthly</td>
                            <td>$18.00</td>
                            <td><span class="status-badge paid">Paid</span></td>
                            <td><a href="#" style="color: var(--primary-color);"><i class="fas fa-download"></i> Download</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Delete Account Section -->
            <div class="section-card full-width">
                <div class="cancel-section">
                    <h3><i class="fas fa-exclamation-triangle"></i> Delete Your Account</h3>
                    <p>
                        If you delete your account, all of your data will be permanently removed. This action cannot be undone.
                    </p>
                    <p>
                        <strong>What will be deleted:</strong>
                    </p>
                    <ul style="margin-left: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary);">
                        <li>All stories and memories</li>
                        <li>All photos and videos</li>
                        <li>All connections and family tree data</li>
                        <li>Your profile and account information</li>
                    </ul>
                    <button class="btn btn-danger" onclick="showCancelModal()">
                        <i class="fas fa-trash-alt"></i> Delete Account
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Plan Modal -->
    <div class="modal" id="upgradePlanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Plan</h3>
                <button class="close-modal" onclick="closeModal('upgradePlanModal')">√ó</button>
            </div>
            
            <div class="plan-options">
                <div class="plan-option current">
                    <div class="plan-option-header">
                        <h4>Premium Plan</h4>
                        <div class="price">$18<span style="font-size: 1rem; font-weight: 400;">/mo</span></div>
                    </div>
                    <p>Full access for one profile</p>
                    <ul class="plan-features" style="list-style: none; padding: 0; margin: 1rem 0 0 0; font-size: 0.9rem;">
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Unlimited stories</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Unlimited AI recordings</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Unlimited connections</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Unlimited storage</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Manage family payments</li>
                    </ul>
                    <span class="badge">Current Plan</span>
                </div>

                <div class="plan-option">
                    <div class="plan-option-header">
                        <h4>Annual Plan</h4>
                        <div class="price">$180<span style="font-size: 1rem; font-weight: 400;">/year</span></div>
                    </div>
                    <p>Save $36/year with annual billing</p>
                    <ul class="plan-features" style="list-style: none; padding: 0; margin: 1rem 0; font-size: 0.9rem;">
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> All Premium Plan features</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Save $36 per year</li>
                    </ul>
                    <button class="btn btn-primary" style="width: 100%; margin-top: 0.5rem;" onclick="changePlan('annual')">
                        Upgrade to Annual
                    </button>
                </div>

                <div class="plan-option">
                    <div class="plan-option-header">
                        <h4>Legacy Plan</h4>
                        <div class="price">$2.50<span style="font-size: 1rem; font-weight: 400;">/mo</span></div>
                    </div>
                    <p>Preserve existing memories without adding new ones</p>
                    <ul class="plan-features" style="list-style: none; padding: 0; margin: 1rem 0; font-size: 0.9rem;">
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Keep all existing stories</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Profile remains active</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-times" style="color: #dc2626; margin-right: 0.5rem;"></i> Cannot add new stories</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-times" style="color: #dc2626; margin-right: 0.5rem;"></i> No AI recording access</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: #f59e0b; margin-top: 0.75rem; line-height: 1.4;">
                        <i class="fas fa-info-circle"></i> Ideal for memorial profiles
                    </p>
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;" onclick="showLegacyConfirmation()">
                        Switch to Legacy
                    </button>
                </div>

                <div class="plan-option">
                    <div class="plan-option-header">
                        <h4>Free Plan</h4>
                        <div class="price">$0<span style="font-size: 1rem; font-weight: 400;">/mo</span></div>
                    </div>
                    <p>Basic viewing access to family networks</p>
                    <ul class="plan-features" style="list-style: none; padding: 0; margin: 1rem 0; font-size: 0.9rem;">
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> Appear on family trees</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-check" style="color: #10b981; margin-right: 0.5rem;"></i> View connected profiles</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-times" style="color: #dc2626; margin-right: 0.5rem;"></i> Profile content removed</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-times" style="color: #dc2626; margin-right: 0.5rem;"></i> No stories or photos</li>
                        <li style="padding: 0.3rem 0; color: #333;"><i class="fas fa-times" style="color: #dc2626; margin-right: 0.5rem;"></i> Cannot add content</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: #666; margin-top: 0.75rem; line-height: 1.4;">
                        <i class="fas fa-eye"></i> Stay connected to family without maintaining a full profile
                    </p>
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;" onclick="showFreeConfirmation()">
                        Switch to Free
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Payment Method</h3>
                <button class="close-modal" onclick="closeModal('paymentModal')">√ó</button>
            </div>
            
            <form id="paymentForm" onsubmit="updatePayment(event)">
                <div class="form-group">
                    <label for="cardNumber">Card Number</label>
                    <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" required maxlength="19">
                    <div class="card-logos">
                        <i class="fab fa-cc-visa"></i>
                        <i class="fab fa-cc-mastercard"></i>
                        <i class="fab fa-cc-amex"></i>
                        <i class="fab fa-cc-discover"></i>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="expiryDate">Expiry Date</label>
                        <input type="text" id="expiryDate" placeholder="MM/YY" required maxlength="5">
                    </div>

                    <div class="form-group">
                        <label for="cvv">CVV</label>
                        <input type="text" id="cvv" placeholder="123" required maxlength="4">
                    </div>
                </div>

                <div class="form-group">
                    <label for="cardName">Cardholder Name</label>
                    <input type="text" id="cardName" placeholder="John Smith" required>
                </div>

                <div class="form-group">
                    <label for="billingZip">Billing ZIP Code</label>
                    <input type="text" id="billingZip" placeholder="12345" required maxlength="10">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-save"></i> Update Payment Method
                </button>
            </form>
        </div>
    </div>

    <!-- Free Plan Option Modal (First Step) -->
    <div class="modal" id="cancelModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Before You Go...</h3>
                <button class="close-modal" onclick="closeModal('cancelModal')">√ó</button>
            </div>
            
            <p style="color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.6; text-align: center; font-size: 1.05rem;">
                Choose the option that's right for you
            </p>

            <style>
                .delete-option-card {
                    border: 2px solid #e5e7eb;
                    border-radius: 12px;
                    padding: 1.75rem;
                    margin-bottom: 1rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    position: relative;
                }
                .delete-option-card:hover {
                    border-color: var(--primary-color);
                    box-shadow: 0 4px 20px rgba(139, 69, 19, 0.15);
                    transform: translateY(-2px);
                }
                .delete-option-card.recommended {
                    border-color: #3b82f6;
                    background: rgba(59, 130, 246, 0.03);
                }
                .delete-option-card.recommended::before {
                    content: "RECOMMENDED";
                    position: absolute;
                    top: -12px;
                    left: 20px;
                    background: #3b82f6;
                    color: white;
                    padding: 0.25rem 0.75rem;
                    border-radius: 20px;
                    font-size: 0.75rem;
                    font-weight: 700;
                }
                .delete-option-card .card-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 1rem;
                }
                .delete-option-card .card-title {
                    font-size: 1.4rem;
                    font-weight: 700;
                    color: var(--text-primary);
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                }
                .delete-option-card .card-price {
                    font-size: 1.5rem;
                    font-weight: 700;
                }
                .delete-option-card.free-plan .card-price { color: #10b981; }
                .delete-option-card.legacy-plan .card-price { color: #f59e0b; }
                .delete-option-card.delete-plan .card-price { color: #dc2626; }
                .delete-option-card ul {
                    list-style: none;
                    padding: 0;
                    margin: 1rem 0;
                }
                .delete-option-card ul li {
                    padding: 0.5rem 0;
                    color: var(--text-secondary);
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                }
                .delete-option-card ul li i {
                    width: 20px;
                }
                .delete-option-card .card-note {
                    background: rgba(0,0,0,0.03);
                    padding: 0.75rem;
                    border-radius: 6px;
                    font-size: 0.9rem;
                    margin-top: 1rem;
                    color: #666;
                }
            </style>

            <!-- Free Plan Card -->
            <div class="delete-option-card recommended free-plan" onclick="switchToFreeFromDelete()">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-gift" style="color: #3b82f6;"></i>
                        Free Plan
                    </div>
                    <div class="card-price">$0/mo</div>
                </div>
                <ul>
                    <li><i class="fas fa-check" style="color: #10b981;"></i> Stay connected - appear on family trees</li>
                    <li><i class="fas fa-check" style="color: #10b981;"></i> View all connected family profiles</li>
                    <li><i class="fas fa-check" style="color: #10b981;"></i> Access your family network</li>
                    <li><i class="fas fa-check" style="color: #10b981;"></i> Data stored for 6 months (restore anytime)</li>
                    <li><i class="fas fa-times" style="color: #dc2626;"></i> Profile content will be removed</li>
                </ul>
                <div class="card-note">
                    ‚ú® Best for staying connected without monthly charges - an option to restore your account for 6 months
                </div>
            </div>

            <!-- Legacy Plan Card -->
            <div class="delete-option-card legacy-plan" onclick="showLegacyConfirmation()">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-heart" style="color: #f59e0b;"></i>
                        Legacy Plan
                    </div>
                    <div class="card-price">$2.50/mo</div>
                </div>
                <ul>
                    <li><i class="fas fa-check" style="color: #10b981;"></i> Keep all existing stories</li>
                    <li><i class="fas fa-check" style="color: #10b981;"></i> Profile remains active</li>
                    <li><i class="fas fa-check" style="color: #10b981;"></i> All photos & videos preserved</li>
                    <li><i class="fas fa-times" style="color: #dc2626;"></i> Cannot add new stories</li>
                </ul>
                <div class="card-note">
                    üíù Perfect for memorial profiles - preserve all memories
                </div>
            </div>

            <!-- Delete Account Card -->
            <div class="delete-option-card delete-plan" onclick="showDeleteConfirmation()">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-trash-alt" style="color: #dc2626;"></i>
                        Delete Account
                    </div>
                </div>
                <ul>
                    <li><i class="fas fa-times" style="color: #dc2626;"></i> All stories permanently deleted</li>
                    <li><i class="fas fa-times" style="color: #dc2626;"></i> All photos & videos removed</li>
                    <li><i class="fas fa-times" style="color: #dc2626;"></i> All connections lost</li>
                    <li><i class="fas fa-times" style="color: #dc2626;"></i> Cannot be undone</li>
                </ul>
                <div class="card-note" style="background: rgba(220, 38, 38, 0.1); color: #dc2626;">
                    ‚ö†Ô∏è This action is permanent and irreversible
                </div>
            </div>

            <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb;">
                <button type="button" class="btn btn-secondary" onclick="closeModal('cancelModal')">
                    Keep Premium Plan
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal (Second Step) -->
    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Your Account</h3>
                <button class="close-modal" onclick="closeModal('deleteConfirmModal')">√ó</button>
            </div>
            
            <p style="color: #dc2626; font-weight: 600; margin-bottom: 1rem; line-height: 1.6;">
                <i class="fas fa-exclamation-triangle"></i> This action is permanent and cannot be undone!
            </p>

            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                All of your stories, photos, videos, connections, and profile data will be permanently deleted.
            </p>

            <form id="cancelForm" onsubmit="cancelSubscription(event)">
                <div class="form-group">
                    <label for="cancelReason">Reason for deleting</label>
                    <select id="cancelReason" required>
                        <option value="">Select a reason</option>
                        <option value="too-expensive">Too expensive</option>
                        <option value="not-using">Not using it enough</option>
                        <option value="missing-features">Missing features I need</option>
                        <option value="technical-issues">Technical issues</option>
                        <option value="privacy-concerns">Privacy concerns</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="feedback">Additional feedback (optional)</label>
                    <input type="text" id="feedback" placeholder="Tell us more...">
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeModal('deleteConfirmModal')">
                        Go Back
                    </button>
                    <button type="submit" class="btn btn-danger" style="flex: 1;">
                        Delete Account Permanently
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Legacy Plan Confirmation Modal -->
    <div class="modal" id="legacyConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Switch to Legacy Plan</h3>
                <button class="close-modal" onclick="closeModal('legacyConfirmModal')">√ó</button>
            </div>
            
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                You're switching to the Legacy Plan at $2.50/month. This plan is designed to preserve existing memories.
            </p>

            <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: var(--radius-sm); padding: 1rem; margin-bottom: 1.5rem;">
                <strong style="color: #f59e0b; display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-exclamation-triangle"></i> Important Limitations:
                </strong>
                <ul style="margin-left: 1.5rem; color: var(--text-secondary); line-height: 1.6;">
                    <li>You will <strong>not be able to add new stories</strong></li>
                    <li>AI recording features will be <strong>disabled</strong></li>
                    <li>All existing stories and connections will remain accessible</li>
                    <li>Your profile will stay active and viewable</li>
                </ul>
            </div>

            <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: var(--radius-sm); padding: 1rem; margin-bottom: 1.5rem;">
                <strong style="color: #10b981; display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-heart"></i> Perfect For:
                </strong>
                <ul style="margin-left: 1.5rem; color: var(--text-secondary); line-height: 1.6;">
                    <li>Memorial profiles for loved ones who have passed</li>
                    <li>Preserving completed family histories</li>
                </ul>
            </div>

            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1.5rem;">
                You can upgrade back to the Premium Plan at any time to regain full features.
            </p>

            <div style="display: flex; gap: 1rem;">
                <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeModal('legacyConfirmModal')">
                    Keep Premium Plan
                </button>
                <button type="button" class="btn btn-primary" style="flex: 1;" onclick="changePlan('legacy')">
                    Confirm Switch to Legacy
                </button>
            </div>
        </div>
    </div>

    <!-- Free Plan Confirmation Modal -->
    <div class="modal" id="freeConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Switch to Free Plan</h3>
                <button class="close-modal" onclick="closeModal('freeConfirmModal')">√ó</button>
            </div>
            
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.6;">
                You're switching to the Free Plan. This will remove all content from your profile but maintain your connections.
            </p>

            <div style="background: rgba(220, 38, 38, 0.1); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: var(--radius-sm); padding: 1rem; margin-bottom: 1.5rem;">
                <strong style="color: #dc2626; display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-exclamation-triangle"></i> Important: Content Will Be Removed
                </strong>
                <ul style="margin-left: 1.5rem; color: var(--text-secondary); line-height: 1.6;">
                    <li><strong>All stories will be deleted</strong> from your profile</li>
                    <li><strong>All photos and videos will be removed</strong></li>
                    <li>Profile information will be cleared</li>
                    <li>You cannot add new content</li>
                    <li>AI recording features will be disabled</li>
                </ul>
            </div>

            <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: var(--radius-sm); padding: 1rem; margin-bottom: 1.5rem;">
                <strong style="color: #10b981; display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-check-circle"></i> What You Keep:
                </strong>
                <ul style="margin-left: 1.5rem; color: var(--text-secondary); line-height: 1.6;">
                    <li>You'll still appear on family trees</li>
                    <li>You can view connected profiles</li>
                    <li>Access to family network remains</li>
                    <li>Completely free - no monthly charges</li>
                </ul>
            </div>

            <p style="color: #dc2626; font-size: 0.95rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-shield-alt"></i> Consider the Legacy Plan ($2.50/mo) to preserve your stories instead
            </p>

            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1.5rem;">
                You can upgrade to the Premium or Legacy Plan at any time to restore full features, but deleted content cannot be recovered.
            </p>

            <div style="display: flex; gap: 1rem;">
                <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="closeModal('freeConfirmModal')">
                    Keep Premium Plan
                </button>
                <button type="button" class="btn btn-danger" style="flex: 1;" onclick="changePlan('free')">
                    Confirm Switch to Free
                </button>
            </div>
        </div>
    </div>

    <script>
        // Load navigation
        fetch('components/navigation.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
                
                // Initialize profile dropdown
                const profileMenuBtn = document.getElementById('profileMenuBtn');
                const profileDropdown = document.getElementById('profileDropdown');
                
                if (profileMenuBtn && profileDropdown) {
                    profileMenuBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        profileDropdown.classList.toggle('active');
                    });
                    
                    document.addEventListener('click', () => {
                        profileDropdown.classList.remove('active');
                    });
                }
            });

        // Modal functions
        function showUpgradeModal() {
            document.getElementById('upgradePlanModal').classList.add('active');
        }

        function showPaymentModal() {
            document.getElementById('paymentModal').classList.add('active');
        }

        function showCancelModal() {
            document.getElementById('cancelModal').classList.add('active');
        }

        function showDeleteConfirmation() {
            closeModal('cancelModal');
            document.getElementById('deleteConfirmModal').classList.add('active');
        }

        function switchToFreeFromDelete() {
            closeModal('cancelModal');
            // Switch to free plan
            changePlan('free');
        }

        function showLegacyConfirmation() {
            closeModal('upgradePlanModal');
            document.getElementById('legacyConfirmModal').classList.add('active');
        }

        function showFreeConfirmation() {
            closeModal('upgradePlanModal');
            document.getElementById('freeConfirmModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Change plan
        function changePlan(plan) {
            // In production: Make API call to change plan
            let message = '';
            let newPrice = '';
            
            if (plan === 'legacy') {
                newPrice = '$2.50/month';
                message = `Plan switched to Legacy Plan at ${newPrice}\n\nYour billing will be updated to the new amount on your next billing date (December 15, 2024).\n\nNote: You will no longer be able to add new stories or use AI recording features, but all existing content will remain accessible.`;
                closeModal('legacyConfirmModal');
            } else if (plan === 'annual') {
                newPrice = '$180/year';
                message = `Plan upgraded to Annual Plan at ${newPrice}\n\nYou will be charged the prorated amount immediately and save $36 per year!`;
                closeModal('upgradePlanModal');
            } else if (plan === 'free') {
                newPrice = 'Free';
                message = `Plan switched to Free Plan\n\nAll content has been removed from your profile. You will no longer be charged monthly.\n\nYou still appear on family trees and can view connected profiles.\n\nUpgrade anytime to restore full features (deleted content cannot be recovered).`;
                closeModal('freeConfirmModal');
            }
            
            alert(message);
            
            // In production: Reload page to reflect new plan
            // location.reload();
        }

        // Update payment method
        function updatePayment(e) {
            e.preventDefault();
            
            const cardNumber = document.getElementById('cardNumber').value;
            const lastFour = cardNumber.slice(-4);
            
            // In production: Make secure API call to update payment method
            alert(`Payment method updated successfully!\n\nNew card ending in ${lastFour}`);
            closeModal('paymentModal');
            
            // Update displayed payment method
            location.reload();
        }

        // Delete account
        function cancelSubscription(e) {
            e.preventDefault();
            
            const reason = document.getElementById('cancelReason').value;
            const feedback = document.getElementById('feedback').value;
            
            // In production: Make API call to delete account
            console.log('Account deletion reason:', reason);
            console.log('Feedback:', feedback);
            
            alert('Your account has been deleted.\n\nAll of your data has been permanently removed.\n\nThank you for using 4Ever. We hope to see you again someday!');
            closeModal('deleteConfirmModal');
            
            // In production: Redirect to login page
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1000);
        }

        // Format card number input
        document.getElementById('cardNumber')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        });

        // Format expiry date input
        document.getElementById('expiryDate')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4);
            }
            e.target.value = value;
        });

        // Format CVV input (numbers only)
        document.getElementById('cvv')?.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '');
        });
    </script>
</body>
</html>

